# ZKPassport NFT Faucet System

Privacy-preserving identity verification system with self-service NFT minting and ETH faucet distribution on Base, Unichain, and Ethereum.

**Repository**: [ETHcali/faucet-ethcali](https://github.com/ETHcali/faucet-ethcali)

## Overview

This project implements a complete system for verifying user identity using ZKPassport (face match + personhood) and distributing ETH to verified users:

- **ZKPassportNFT**: Soulbound ERC721 NFT representing verified identity (self-verification mint)
- **FaucetVault**: One-time ETH distribution to NFT holders

## Contracts

### Contract Addresses

Addresses are generated by Hardhat Ignition and exported via the setup script. Run the setup to produce multi-network addresses and ABIs for your frontend:

```bash
npx hardhat run scripts/setup-frontend.ts
```

Then use the generated files in `frontend/` (contracts.json, addresses.json, contracts.ts, abis/).

### Swag1155 (ERC-1155 Swag)

- **Standard**: ERC-1155 with per-token metadata URIs
- **Payments**: USDC `transferFrom` to a configurable `treasury`
- **Admin creates products dynamically**:
  - Upload image → pin to IPFS
  - Set price, total supply, traits (gender, color, style)
  - Select sizes (S, M, L, XL)
  - Supply auto-splits per size (e.g., 20 total → 5 per size)
  - Frontend pins metadata per size → calls `setVariantWithURI()`
- **User buys**:
  - Select size (color) → quantity
  - Approve USDC → `buy(tokenId, quantity)`
  - NFT minted instantly with IPFS metadata

**Frontend integration guide**: See [SWAG1155_FRONTEND.md](SWAG1155_FRONTEND.md) for complete admin & user flows, code examples, and React components.

## Features

- ✅ **Soulbound NFTs**: Non-transferable identity tokens
- ✅ **On-chain Metadata**: Dynamic SVG images with verification traits
- ✅ **One-time Claims**: Each verified user can claim ETH once
- ✅ **Multi-chain Ready**: Deploy to Base, Unichain, or Ethereum

## Quick Start

### Installation

```bash
npm install
```

### Configuration

Create a `.env` file:

```bash
PRIVATE_KEY=your_deployer_private_key  # Needs ETH to deploy/manage contracts

# RPC URLs
BASE_RPC_URL=https://base-mainnet.infura.io/v3/your_key
ETHEREUM_RPC_URL=https://mainnet.infura.io/v3/your_key
UNICHAIN_RPC_URL=https://unichain-mainnet.infura.io/v3/your_key

# Block Explorer API Keys
ETHERSCAN_API_KEY=your_key
BASESCAN_API_KEY=your_key
UNICHAIN_API_KEY=your_key  # Optional, for contract verification
```

### Compile Contracts

```bash
npx hardhat compile
```

### Run Tests

```bash
npx hardhat test
```

### Deploy (Hardhat v3 Ignition)

Deploy all contracts (ZKPassportNFT, FaucetVault, Swag1155) at once:

```bash
# Clean deploy to Base Mainnet
rm -rf ignition/deployments/chain-8453
npx hardhat ignition deploy ignition/modules/DeployAll.ts --network base

# Clean deploy to Ethereum Mainnet
rm -rf ignition/deployments/chain-1
npx hardhat ignition deploy ignition/modules/DeployAll.ts --network ethereum

# Clean deploy to Unichain Mainnet
rm -rf ignition/deployments/chain-130
npx hardhat ignition deploy ignition/modules/DeployAll.ts --network unichain
```

**Note**: Always delete the deployment directory before deploying to avoid resuming old deployments.

### Setup Frontend Files

Generate ABIs and addresses for frontend integration (run after each deployment):

```bash
npx hardhat run scripts/setup-frontend.ts
```

This reads Ignition deployments and creates a `frontend/` directory with:
- `contracts.json` - Multi-network config with all deployed networks
- `addresses.json` - All network addresses in one file
- `contracts.ts` - TypeScript exports with multi-network helpers
- `abis/` - Shared ABIs (same for all networks)
- `base/` - Base Mainnet specific files
- `unichain/` - Unichain Mainnet specific files
- `ethereum/` - Ethereum Mainnet specific files

See `frontend/README.md` for detailed usage examples.

### Verify Contracts

Verify all contracts on block explorers (run after setup-frontend):

```bash
# Verify on Base (Basescan + Sourcify)
npx hardhat run scripts/verify-contracts.ts --network base

# Verify on Ethereum (Etherscan + Sourcify)
npx hardhat run scripts/verify-contracts.ts --network ethereum

# Verify on Unichain (Uniscan + Sourcify)
npx hardhat run scripts/verify-contracts.ts --network unichain
```

**Verifies automatically:**
- ✅ ZKPassportNFT with constructor args: `["ZKPassport", "ZKP"]`
- ✅ FaucetVault with constructor args: `[nftAddress, "100000000000000"]`
- ✅ Swag1155 with constructor args: `[baseURI, usdcAddress, treasuryAddress]`

**Requirements:**
- Run `setup-frontend.ts` first to generate addresses
- Set `BASESCAN_API_KEY`, `ETHERSCAN_API_KEY` in `.env`
- Verifies on multiple explorers: Etherscan/Basescan/Uniscan + Sourcify

## Architecture

```
User → ZKPassport Verification → Frontend → ZKPassportNFT
                           ↓
                         FaucetVault (one-time claim)
```

1. User verifies identity via ZKPassport (face match + personhood)
2. Frontend receives verification data from SDK
3. User mints their soulbound NFT via `mintWithVerification()`
4. Verified users claim ETH from FaucetVault (one-time)

## Contract Details

### ZKPassportNFT

- **Standard**: ERC721 with soulbound restrictions
- **Metadata**: On-chain Base64 JSON with dynamic SVG
- **Traits**: Face Match status, Personhood verification
- **Limits**: One NFT per uniqueIdentifier, one per address

### Duplicate Prevention

- **Per-Identifier**: Each ZKPassport `uniqueIdentifier` can be used only once
- **Per-Address**: Each address can hold only one NFT

### FaucetVault

- **Purpose**: Distributes ETH to verified users
- **Claim**: One-time claim per NFT holder
- **Amount**: Configurable by admin (default: 0.0001 ETH)
- **Security**: Pausable, reentrancy-protected

## Network Support

- ✅ Base Mainnet (Chain ID: 8453)
- ✅ Ethereum Mainnet (Chain ID: 1)
- ✅ Unichain Mainnet (Chain ID: 130)

## Security

- Reentrancy guards on all external calls
- Signature replay protection (nonces)
- Access control (Ownable pattern)
- Input validation
- Pausable emergency controls

## Repository

- **GitHub**: [ETHcali/faucet-ethcali](https://github.com/ETHcali/faucet-ethcali)

## License

MIT
